
create:
  tran.spi: |
    *${IP}/${CELL}
    *----------------------------------------------------------------
    * Include
    *----------------------------------------------------------------
    #ifdef Lay
    .include ../../../work/lpe/${CELL}_lpe.spi
    #else
    .include ../../../work/xsch/${CELL}.spice
    #endif

    *-----------------------------------------------------------------
    * OPTIONS
    *-----------------------------------------------------------------
    #ifdef Debug
    .option reltol=1e-3 srcsteps=1 ramptime=10n noopiter keepopinfo gmin=1e-12
    #else
    .option reltol=1e-5 srcsteps=1 ramptime=10n noopiter keepopinfo gmin=1e-15
    #endif

    *-----------------------------------------------------------------
    * PARAMETERS
    *-----------------------------------------------------------------
    .param TRF = 10p

    .param AVDD = {vdda}

    *-----------------------------------------------------------------
    * FORCE
    *-----------------------------------------------------------------
    VSS  VSS  0     dc 0
    VDD  VDD_1V8  VSS  pwl 0 0 10n {AVDD}

    *-----------------------------------------------------------------
    * DUT
    *-----------------------------------------------------------------
    XDUT ${PORTS} ${CELL}

    *----------------------------------------------------------------
    * MEASURES
    *----------------------------------------------------------------


    *----------------------------------------------------------------
    * PROBE
    *----------------------------------------------------------------

    #ifdef Debug
    .save all
    #else
    .probe ${VPORTS}
    #endif

    *----------------------------------------------------------------
    * NGSPICE control
    *----------------------------------------------------------------
    .control
    set num_threads=8
    set color0=white
    set color1=black
    unset askquit

    #ifdef Debug
    tran 10p 1n 1p
    *quit
    #else
    tran 10p 10n 1p
    write
    quit
    #endif

    .endc

    .end

  cicsim.yaml: |
    corner:
      Lay: ''
      Sch: ''
    ngspice:
      library: ${IP}
      cell: ${CELL}
  Makefile: |
    TB=tran
    VIEW=Sch
    #VIEW=Lay

    OPT=

    netlist:
    	cd ../../work && xschem -q -x -b -s -n ../design/${IP}/${CELL}.sch
    	perl -pi -e "s/\*\*\.subckt/\.subckt/ig;s/\*\*\.ends/\.ends/ig;" ../../work/xsch/${CELL}.spice


    test:
    	${MAKE} typical OPT="Debug"

    typical:
    	cicsim run ${TB} ${OPT} ${VIEW} Gt Att Tt Vt

    slow:
    	cicsim run ${TB} ${OPT} ${VIEW} Gt Ass "Th,Tl" Vl

    fast:
    	cicsim run ${TB} ${OPT} ${VIEW} Gt Aff "Th,Tl" Vh

    tfs:
    	cicsim run ${TB} ${OPT} ${VIEW} Gt "Att,Ass,Aff" "Tt,Th,Tl" Vt

    ttffss:
    	cicsim run ${TB} ${OPT} ${VIEW} Gt "Att,Ass,Aff" "Tt" Vt

    temp:
    	cicsim run ${TB} ${OPT} ${VIEW} Gt "Att" "Tt,Th,Tl" Vt

    clean:
    	-rm -rf output_*
    	-rm -rf __pycache__
    	-rm *.run
    	-rm *.pdf
    	-rm *.csv
do:
  - make netlist
  - cicsim portreplace tran.spi ../../work/xsch/${CELL}.spice ${CELL}
  - git add Makefile cicsim.yaml tran.spi


echo: |
  Good luck with ${IP} ${CELL}
